<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>The New ASP.NET AJAX: Part 1 - Getting Started with the Script Loader - Endless Obsession | Bryan Matthews</title><meta name="author" content="Bryan Matthews"><meta name="description" content="The personal blog of Bryan Matthews"><!-- Viewport and Media Queries: http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://endlessobsession.com/" rel="canonical"><link href="https://endlessobsession.com/infinity-symbol.png" rel="icon"><link href="https://endlessobsession.com/atom.xml" rel="alternate" type="application/atom+xml" title="Endless Obsession"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link href="https://endlessobsession.com/stylesheets/theme-3.0.css" media="screen, projection" rel="stylesheet" type="text/css"><link href="https://endlessobsession.com/stylesheets/tomorrow.css" media="screen, projection" rel="stylesheet" type="text/css"></head><body><div><header role="banner"><hgroup><h1><a href="https://endlessobsession.com/">Endless Obsession</a></h1><small>better code</small></hgroup><nav role="navigation"><ul><li><a href="https://endlessobsession.com/">Home</a></li><li><a href="https://endlessobsession.com/about" rel="author">About</a></li><li><a href="https://endlessobsession.com/blog/archives">Blog</a></li></ul><form action="https://google.com/search"><fieldset role="search"><input type="hidden" name="q" value="site:https://endlessobsession.com/"><input class="search" type="text" name="q" results="0" placeholder="Search" autocomplete="off"></fieldset></form></nav><nav role="complementary"><ul><li><a href="https://endlessobsession.com/atom.xml" title="RSS">RSS</a></li><li><a href="https://github.com/mattheyan" title="Github: mattheyan" target="_blank">Github</a></li><li><a href="https://twitter.com/BryanMatthews" title="Twitter: @BryanMatthews" target="_blank">Twitter</a></li></ul></nav></header><main><article><header><h2 class="title">The New ASP.NET AJAX: Part 1 - Getting Started with the Script Loader</h2><div class="byline"><span class="author">Bryan Matthews</span><time datetime="2010-02-10" pubdate>Feb 10th, 2010</time></div></header><section><p><strong>Background</strong>:  I had an existing <span class="caps">ASP</span>.NET AJAX-enabled application and wanted to use the Script Manager control in conjunction with the new client-only Script Loader.  I wasn’t quite sure how they would work together and there is (understandably) precious little in the way of documentation.  Here is what I have found so far…<br><em>By the way, if you haven’t heard of the Script Loader then you can read about it <em>[</em>here_](<a href="http://weblogs.asp.net/scottgu/archive/2009/10/15/announcing-microsoft-ajax-library-preview-6-and-the-microsoft-ajax-minifier.aspx">http://weblogs.asp.net/scottgu/archive/2009/10/15/announcing-microsoft-ajax-library-preview-6-and-the-microsoft-ajax-minifier.aspx</a>)</em> and <em>[</em>here_](<a href="http://weblogs.asp.net/bleroy/archive/2009/11/23/enabling-the-asp-net-ajax-script-loader-for-your-own-scripts.aspx">http://weblogs.asp.net/bleroy/archive/2009/11/23/enabling-the-asp-net-ajax-script-loader-for-your-own-scripts.aspx</a>)<em>, or Google it (with&nbsp;Bing…)!</em></p>
<h2 id="include-the-script-loader">Include the Script&nbsp;Loader</h2>
<p>My first thought was to just include the script loader’s script file (“start.js”) early, before the page scripts that would use it.  Unfortunately, this line of code gave me&nbsp;grief.</p>
<pre><code class="language-javascript"><span class="keyword">if</span>(<span class="keyword">typeof</span>(Sys) !== <span class="string">"undefined"</span>) Sys.Application.notifyScriptLoaded();</code></pre>
<p>It’s automatically appended to script references so we’re stuck with it.  This line of code predates the Script Loader, unfortunately.  When it was written the <span class="caps">AJAX</span> JavaScript library lived in one big JavaScript file, so you either had it or you didn’t.  Today, the start script defines <em>Sys</em> (so that you can do things like <em>Sys.require_), but it doesn’t define the _Application</em> namespace.  Therefore, the above line of code causes a “null or not an object” error.  In order to get around this you just have to make sure that the start script is injected farther down the page than other script references that may include the offending line of code.  In my case I used the ScriptManagerProxy&nbsp;control.</p>
<h2 id="define-your-scripts">Define Your&nbsp;Scripts</h2>
<p>This step is optional if you are just using the scripts from Microsoft or&nbsp;jQuery.</p>
<pre><code class="language-javascript">Sys.loader.defineScripts({
    <span class="attr">releaseUrl</span>: <span class="string">"%/{0}.js"</span>,
    <span class="attr">debugUrl</span>: <span class="string">"%/{0}.debug.js"</span>
}, [{
    <span class="attr">name</span>: <span class="string">"MyScript"</span>,
    <span class="attr">executionDependencies</span>: [<span class="string">"WebServices"</span>],
    <span class="attr">isLoaded</span>: !!(MyControl)
}]);</code></pre>
<p>The first argument is named <em>defaultScriptInfo_, in case you’re wondering.  Sounds interesting, doesn’t it?  This is where you can put the common settings for all of the scripts that you are defining here.  No need to repeat yourself.  If you want you can pass _null</em> and be done with&nbsp;it.</p>
<p>The second argument is an array of JavaScript objects that tell the Script Loader everything it needs to know about each individual script(s).  Here’s a breakdown of the&nbsp;properties:</p>
<p><strong>name</strong>:  This one is pretty obvious.  I assume that you can use any arbitrary text here, but you may want to be selective since it will ultimately be used in JavaScript code.  This is the name that you will use in other script definitions to indicate that it is a dependency (“WebServices” in the above example).  It is also the attribute name that is tacked on to the Sys.scripts&nbsp;object.  </p>
<p><strong>releaseUrl</strong>:  This is the url (sort of) that can be used to load our script in release mode.  This is the literal url, with two exceptions.  First, the special “%” character is a placeholder for “the place that I got this script from” (the script loader script).  This means that if you downloaded the start script form <span class="caps">CDN</span>, then all of the other scripts that you request will also come from CDN.  If you download it from your web server, then all of the other scripts will come from your web server.  Also, “{0}” is replaced with the script name.  This is useful if you’re defining a common url&nbsp;scheme.</p>
<p><strong>debugUrl</strong>:  Same as _releaseUrl_, except that this url is used in debug&nbsp;mode.</p>
<p><strong>dependencies</strong> and <strong>executionDependencies</strong>:  An array of script names.  These are the scripts that must be present before your script can function.  These two attributes accomplish this in slightly different ways.  (_<strong>Disclaimer</strong>_:  my current understanding of these options is based on reading through code as well as some guess work.)  As I understand it, dependencies indicates that the script loader should wait for the dependencies before it attempts to load the script, whereas executionDependencies indicates that the script loader can fetch scripts in parallel and then execute them in the correct order (more on this&nbsp;later).</p>
<p><strong>isLoaded</strong>:  Tells the script loader whether or not your script is already loaded.  This is useful for things like jQuery that may be commonly included as a static script reference, or for scripts that may or may not be included by the Script&nbsp;Manager.</p>
<h2 id="fix-your-script-files">Fix Your Script&nbsp;Files</h2>
<p>In order to take full advantage of the script loader you will need to change your files to looks something like&nbsp;this:</p>
<pre><code class="language-javascript">;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="function"><span class="keyword">function</span> <span class="title">execute</span> (<span class="params"></span>) </span>{
        <span class="comment">// bunch o' code...</span>
    }

    <span class="keyword">if</span> (<span class="built_in">window</span>.Sys &amp;&amp; Sys.loader) {
        Sys.loader.registerScript(<span class="string">"MyScript"</span>, <span class="literal">null</span>, execute);
    }
    <span class="keyword">else</span> {
        execute();
    }
}) ();</code></pre>
<p>That bit at the end looks for the Script Loader and if it is found it tells the Script Loader that it is ready to execute whenever its dependency are loaded.  Otherwise, it simply executes on the spot.  That way it can function with or without the Script&nbsp;Loader.</p>
<p>With this in mind the distinction between <em>dependencies</em> and <em>executionDependencies</em> makes more sense.  You may not be able to change a script to match this format.  If that is the case, then the scripts cannot be fetched in&nbsp;parallel.</p>
<h2 id="using-your-scripts">Using Your&nbsp;Scripts</h2>
<pre><code class="language-javascript">Sys.require([Sys.scripts.MyScript], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{
    <span class="comment">// bunch o' code...</span>
});</code></pre>
<p>It’s as simple as that!  The function that you provide as the second argument is executed whenever the required scripts have been&nbsp;loaded.</p>
</section><section><h2>Comments</h2><div id="disqus_thread"></div></section></article><footer><script type="text/javascript" src="/javascripts/disqus.js?v=2.0.0&amp;name=endlessobsession"></script><small>Copyright &copy; 2023 - Bryan Matthews &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a></small><script type="text/javascript" src="/javascripts/analytics.js?v=1.0.0&amp;id=UA-17782995-1"></script></footer></main></div></body></html>