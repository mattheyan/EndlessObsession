<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Tiny MCE Spellchecker Gotcha - Bryan Matthews</title><meta name="author" content="Bryan Matthews"><meta name="description" content="The personal blog of Bryan Matthews"><!-- Viewport and Media Queries: http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="https://endlessobsession.com/" rel="canonical"><link href="/infinity-symbol.png" rel="icon"><link href="/atom.xml" rel="alternate" type="application/atom+xml" title="Bryan Matthews"><link href="/stylesheets/normalize-3.0.2.css" media="screen, projection" rel="stylesheet" type="text/css"><link href="/stylesheets/theme-2.0.css" media="screen, projection" rel="stylesheet" type="text/css"><link href="/stylesheets/tomorrow.css" media="screen, projection" rel="stylesheet" type="text/css"></head><body><div class="container"><header role="banner"><hgroup><h1><a href="https://endlessobsession.com/">Bryan Matthews</a></h1><small>better code</small></hgroup><nav role="navigation"><ul><li><a href="https://endlessobsession.com/">Home</a></li><li><a href="https://endlessobsession.com/about" rel="author">About</a></li><li><a href="https://endlessobsession.com/blog/archives">Blog</a></li></ul><form action="https://google.com/search"><fieldset role="search"><input type="hidden" name="q" value="site:https://endlessobsession.com/"><input class="search" type="text" name="q" results="0" placeholder="Search"></fieldset></form></nav><nav role="complementary"><ul><li><a href="/atom.xml" title="RSS">RSS</a></li><li><a href="https://github.com/mattheyan" title="Github: mattheyan" target="_blank">Github</a></li><li><a href="https://twitter.com/BryanMatthews" title="Twitter: @BryanMatthews" target="_blank">Twitter</a></li></ul></nav></header><main><article><header><h2 class="title">Tiny MCE Spellchecker Gotcha</h2><div class="byline"><span class="author">Bryan Matthews</span><time datetime="2010-06-10" pubdate>Jun 10th, 2010</time></div></header><section><p>In hindsight this should have been a lot&nbsp;easier…</p>
<p>If you’re not familiar with <a href="http://tinymce.moxiecode.com/">tinymce</a> you should go <a href="http://tinymce.moxiecode.com/examples/full.php">check it out</a>.  Its a solid rich text editor for the web, which can be easily initialized and manipulated via JavaScript.  And best of all, <a href="http://tinymce.moxiecode.com/download.php">its free</a>!</p>
<p>Today I ran into a problem with the spell checking feature.  I’ll go ahead and state up front:  this was <strong><span class="caps">NOT</span></strong> a problem with tinymce.  This was my own doing.  It seemed that, although the spell checker was able to report misspellings in the editor, when you clicked on a misspelled word the highlighting would disappear and no context menu was shown.&nbsp;Strange…</p>
<p>First off, tinymce’s source code can be downloaded from <a href="http://tinymce.moxiecode.com/download.php">their site</a> (see “Deveopment package”), which made debugging <strong><em>really</em></strong> easy.  I noticed while inspecting the page using <a href="http://getfirebug.com/">firebug</a> that when I triggered spell checking the misspelled word(s) in the editor were wrapped in a span with a special class name.  I tracked down the spot in the code where the text was wrapped happened, and more importantly unwrapped, and then set breakpoints so that I could intercept when this was happening.  I found that it was ultimately being called from a “mousedown” event, which was in turn creating a new undo operation in the editor and firing the editor’s custom “change”&nbsp;event.</p>
<p>This took me back a few month to when I was integrating the editor into the website.  We basically use the editor to replace text areas on the page, which I gather is the norm.  Believe it or not, tinymce is kind enough to keep the original text area up to date as you make changes.  Unfortunately it doesn’t seem to fire the native browser events that we needed to detect that these changes were occurring.  The editor has its own <a href="http://wiki.moxiecode.com/index.php/Editor">events</a>, some which mimic native browser&nbsp;events.</p>
<p>One in particular that I was interested in was the “<a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/onChange">onChange</a>“ event.  The documentation states that the event is raised “<em>when contents inside the editor gets changed</em>.”  If you look at the event handler arguments (Parameters) you’ll see that it makes mention of “undo levels” and “undo managers”.  As I understand it, the event actually fires when an “undo level” is added, some atomic action that can be reverted.  This explains why changes were being picked up at seemingly arbitrary times while editing the&nbsp;text.</p>
<p>Anyway, what does any of this have to do with the spell checking results disappearing?  Well, it turns out there were a couple of factors at work here.  The first I have already hinted at.  We were watching for “change” events on the editor and reacting accordingly.  These change events were also firing when you click inside of the editor, which is something that you would obviously do if you were trying to fix a typo to get rid of that nasty red underlining.  I presume this is because when the user has clicked, the text that they have typed can be viewed as an atomic action.  This can be slightly confusing if you don’t know what to expect, but it does make some sense in that it follows Microsoft Word behavior (a worthy goal for a rich text&nbsp;editor).</p>
<p>At any rate, the second factor was even more tricky.  The behavior that depends on knowing when the editor changes  (the reason we’re subscribing to the onChange event in the first place) also has to know what the current value is.  It is essentially a property change eventing mechanism.  This is all well and good, except that I was getting the editor’s value through the editor object’s <a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/getContent">getContent</a> method, without so much as skimming the documentation for it (it seemed pretty straightforward).  The documentation states that the function will “<em>cleanup the content before it gets returned using the different cleanup rules options</em>.”</p>
<p>If you think about it for a minute, you can see why this is a problem.  The editor’s content is essentially going to be the html that is displayed, right?  So, if the function is going to return the editor’s content, then it seems reasonable for it to “_cleanup the content_” first.  And what would cleaning up the content involve?  That’s right!  It removes the html that wraps the text to signify that a word is misspelled.  After all, we wouldn’t want to store that in the&nbsp;database.</p>
<p>So at this point I’ve determined what the problem is.  Luckily, it doesn’t appear that I need to call the getContent method after all.  The original text area’s value is updated anyway, so I just read the value directly from the text area.  Problem solved!  Now I can go&nbsp;home…</p>
</section><section><h2>Comments</h2><div id="disqus_thread"></div></section></article><footer><script type="text/javascript" src="/javascripts/disqus.js?v=2.0.0&amp;name=endlessobsession"></script><small>Copyright &copy; 2022 - Bryan Matthews &mdash; powered by&nbsp;<a href="https://github.com/jnordberg/wintersmith">Wintersmith</a></small><script type="text/javascript" src="/javascripts/analytics.js?v=1.0.0&amp;id=UA-17782995-1"></script></footer></main></div></body></html>