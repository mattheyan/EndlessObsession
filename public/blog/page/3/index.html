
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The Endless Obsession</title>
  <meta name="author" content="Bryan Matthews">

  
  <meta name="description" content="How to sequence values in a table.  The non-so-elegant solution&#8230; Imagine you have a table that contains records with a foreign key (string, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://endlessobsession.heroku.com/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="The Endless Obsession" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-17782995-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The Endless Obsession</a></h1>
  
    <h2>better code</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:endlessobsession.heroku.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <!--<li><a href="/guides">Guides</a></li>-->
  <li><a href="/about">About</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/sequenced-sql-records">Sequenced SQL Records</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-27T18:17:20-04:00" pubdate data-updated="true">Jul 27<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>How to sequence values in a table.  The non-so-elegant solution&#8230;</h3>

<p>Imagine you have a table that contains records with a foreign key (string, int, guid, etc&#8230;) and an index or sequence number, 1-3, so that there are three records for each foreign key value.  In another table you have any number of records that contain the same foreign key, as well as a value field (date, number, string, etc&#8230;) that can be sequenced in some logical fashion corresponding to the sequence 1-3 in the key table.  You mission (should you choose to accept it) is to get the values from the value table and join them to the corresponding sequence records in the key table.</p>

<p>What follows is the answer I arrived at late this afternoon.  Please let me know if you have a better way.</p>

<ul>
<li><p>declare @dates table(num varchar(9), date datetime)</p></li>
<li></li>
<li><p>insert into @dates</p></li>
<li><p>select &#8216;192837465&#8217;, cast(&#8216;1/3/2008&#8217; as datetime) union</p></li>
<li><p>select &#8216;192837465&#8217;, cast(&#8216;3/12/2003&#8217; as datetime) union</p></li>
<li><p>select &#8216;192837465&#8217;, cast(&#8216;5/22/2010&#8217; as datetime) union</p></li>
<li><p>select &#8216;192837465&#8217;, cast(&#8216;2/1/2004&#8217; as datetime)</p></li>
<li></li>
<li><p>declare @keys table(num varchar(9), sequence int)</p></li>
<li></li>
<li><p>insert into @keys</p></li>
<li><p>select &#8216;192837465&#8217;, 1 union</p></li>
<li><p>select &#8216;192837465&#8217;, 2 union</p></li>
<li><p>select &#8216;192837465&#8217;, 3</p></li>
<li></li>
<li><p>select</p></li>
<li><p>k.num,</p></li>
<li><p>k.sequence,</p></li>
<li><p>date = (select MIN(t.date) from (select top 1 date from @dates where num = k.num order by date desc) t)</p></li>
<li><p>from @keys k</p></li>
<li><p>where sequence = 1</p></li>
<li><p>union</p></li>
<li><p>select</p></li>
<li><p>k.num,</p></li>
<li><p>k.sequence,</p></li>
<li><p>date = (select MIN(t.date) from (select top 2 date from @dates where num = k.num order by date desc) t)</p></li>
<li><p>from @keys k</p></li>
<li><p>where sequence = 2</p></li>
<li><p>union</p></li>
<li><p>select</p></li>
<li><p>k.num,</p></li>
<li><p>k.sequence,</p></li>
<li><p>date = (select MIN(t.date) from (select top 3 date from @dates where num = k.num order by date desc) t)</p></li>
<li><p>from @keys k</p></li>
<li><p>where sequence = 3</p></li>
</ul>


<p>I union the key table 3 times, filtering by each sequence number.  In each sub-query, the value is obtained by selecting the top N values, filtered by the foreign key and ordered by their value (descending), and then getting the min value.</p>

<p>Kind of an odd-ball case, but I might find this humorous one day.  And Pete will laugh, because I laughed at my code.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/getting-things-done">Getting Things Done (GTD)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-21T06:10:40-04:00" pubdate data-updated="true">Jul 21<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately I&#8217;ve become somewhat obsessed with getting things done.  I wasn&#8217;t always this way, I swear!  In my younger days I was as disorganized and lazy as anyone.  And I procrastinated sometimes (understatement of the year).</p>

<p>For me, getting things done has to be more than a state of mind or goal, it has to be a <strong>system</strong> and a <strong>habit</strong>.  I didn&#8217;t come to this conclusion all at once.  It happened gradually, and I&#8217;m always trying to be better.  The system looks something like this:</p>

<hr />

<hr />

<ul>
<li><p><strong><em>Always</em></strong> write things down (requires discipline &amp; habit)</p></li>
<li><p>Make sure its in your face or readily available</p></li>
<li><p>Use a check list system to provide positive reinforcement</p></li>
<li><p>Figure out how everything works together and stick with it</p></li>
</ul>


<h3>I think I was supposed to do something&#8230;</h3>

<p>It started with the realization that I can be <strong><em>extremely</em></strong> forgetful.  At least, I think thats how it started&#8230;  So, the natural response to this realization was to start writing down EVERYTHING, with the understanding that if it isn&#8217;t written down I won&#8217;t remember it and, therefore, there is <strong><em>zero</em></strong> chance that it will be done.  That&#8217;s a little extreme, but sometimes it helps to think about things in terms of the worst-case scenario.  I started out using <a href="http://lifehacker.com/5321180/turn-gmail-into-your-ultimate-gtd-inbox">GMail</a>, Google tasks, Google calendar, and, eventually, <a href="http://rememberthemilk.com">remember the milk</a>.</p>

<p>I&#8217;m going to jump ahead of myself and talk about ways to make sure you always write things down.  In the beginning I would write things on sheets of paper and even on my hand and arm at times.  This is convenient, but its not the most reliable system.  I use RTM pretty heavily at this point, so it gets a lot of my attention when it comes to efficiency.</p>

<p>The first thing I did was make sure that RTM could be launched as a desktop app using the shortcut launching software of my choice (<a href="http://www.launchy.net/">launchy</a>).  I accomplished this using <a href="http://prism.mozillalabs.com/">Prism</a>, which allows you to use firefox to convert a website into a desktop application.  This is important to me for two reason:  isolation and convenience.  First, a website like RTM is different than most in that I don&#8217;t need to be connected to the rest of the web and I don&#8217;t need to arrive there from anywhere else.  In essence, it is less like a traditional website and more like a standalone application.  Second, I would like to be able to have RTM open and close in the blink of an eye.  Currently I can type Win+Space (to open launchy), then rtm (or any other query that finds my prism app), then Enter, and remember the milk is open pretty much immediately.  Then, thanks to RTM keyboard shortcuts, I can type in a new task (or do pretty much anything else) and my hands never have to leave the keyboard!  If I could get Vimium to play nice with RTM things would be even better!</p>

<p>What I have been looking at more recently is the ability to add a task <strong><em>directly from launchy</em></strong>.  What makes this possible is the fact that remember the milk supports <a href="http://www.rememberthemilk.com/help/answers/sending/emailinbox.rtm">adding tasks via email</a>.  There was a solution for this that <a href="http://lifehacker.com/284127/take-launchy-beyond-application-launching">uses twitter</a>, but I have heard that it isn&#8217;t very reliable.  I would rather not go back to writing notes on my hand and hoping that I don&#8217;t need to wash them.  More recently there have been a couple of solutions that make use of the email API instead (<a href="http://lifehacker.com/5197116/remember-the-milk-for-launchy-adds-tasks-in-a-flash">lifehacker</a> and <a href="http://sheenonline.biz/2008/07/remember-the-milk-posting-directly-from-your-desktop/">sheenonline</a>).  I&#8217;m currently using a modified version of the second option, which I will try to finish up and post soon.</p>

<p>Because of all of this, most basic task management can be accomplished with very little impact on my normal workflow.</p>

<h3>Break the Procrastination Habit</h3>

<p>Well, that&#8217;s great progress, but its not the end of the story.  The second realization was that if I write things down I won&#8217;t forget them, but that doesn&#8217;t mean I&#8217;ll actually do them.  I&#8217;m still lazy and I like to procrastinate.  I had defeated forgetfulness, now I set out on a glorious crusade against the forces of procrastination.  My first order of businesses was to make sure that the &#8220;things&#8221; were always before me, which would (in theory) increase the odds that they actually &#8220;get done&#8221;.</p>

<p>I started out by <a href="http://www.rememberthemilk.com/services/gmail/">adding RTM to my GMail inbox</a> (the gadget, not the browser add-on) and my <a href="http://www.rememberthemilk.com/services/googlecalendar/">Google calendar</a>.  Of course, this is only useful as long as I&#8217;m using GMail or my calendar.  Since I use windows 7 at work, I installed the &#8221;<a href="http://gallery.live.com/liveItemDetail.aspx?li=55ccf415-af76-4a33-bad6-5bdaa370b214">I Forgot the Milk</a>&#8221; desktop gadget, which gives you basically the same view as the GMail gadget.  With the <a href="http://nes.bplaced.net/sidebar7.html">windows 7 sidebar gadget</a>, I can be sure that my tasks are <strong><em>always visible</em></strong> on my desktop.  There is also a handy little app that allows you to run the same interface as a <a href="http://www.adobe.com/cfusion/marketplace/index.cfm?event=marketplace.offering&amp;offeringid=10052&amp;marketplaceid=1">desktop app</a>, but I don&#8217;t have any use for it currently.</p>

<h3>The Task List</h3>

<p>Now that I&#8217;m using RTM, I need to figure out how to use its many feature effectively.  Here is a collection of notes about how I use RTM.  I will modify this as I refine the process.</p>

<h4>List</h4>

<p>I started out with only a couple of lists, but the number has grown.  The reason for this is that more lists means fewer tasks in each list, which means less tasks that I never see (and forget about) because they extend beyond the browser window.  Logical grouping is the main factor when deciding on lists, but a low task count is a close second.</p>

<h4>Priorities</h4>

<p>The tasks in RTM can be assigned a priority of 1-3 (or none).  This is useful because it determines the order of tasks in RTM and related apps.  I have bounced around between only assigning priorities to some tasks, then assigning to all tasks, then back to only some.  Recently I have started using the following rule-of-thumb to assigning priorities, rather than arbitrary choices.  I must resist the urge to make everything priority 1 :)</p>

<ol>
<li><p>High Priority:  These tasks absolutely have to be done.  You don&#8217;t want to forget about them, and your life will be adversely affected if you fail to complete.  If there is a due date assigned, it is probably not an optional due date (ex:  pay rent, schedule dentist appointment).</p></li>
<li><p>Medium Priority:  These tasks are also important, but life will go on if they are not done.  If a due date is assigned it should be done by then, but is probably somewhat flexible (ex:  important phone call, write blog post).</p></li>
<li><p>Low Priority:  These are less important tasks that don&#8217;t necessarily have to be done, but you have decided that you want to, as time permits.  These usually won&#8217;t have due dates, except in the case that it is something that happens at a certain date/time but is still optional, or something that you do at a regular interval (ex:  watch world cup final, clean bathroom sink).</p></li>
<li><p>No Priority:  These are tasks that are things that you <strong><em>might </em></strong>want to do, but haven&#8217;t decided the if or when.</p></li>
</ol>


<h4>Due Date</h4>

<p>I have been in the habit of assigning due dates to tasks and then postponing them repeatedly.  Kind of depressing&#8230;</p>

<p>There are two ways that I use due date:  when something is due (really), and when I <strong><em>want</em></strong> to do something.  Differentiating between the two is something that I have not been able to figure out (suggestions welcome).  Because of the way that I use gadgets I think I am pretty much tied to using due date for both <strong><em>real</em></strong> due dates and <strong><em>pseudo</em></strong> due dates.</p>

<h4>Repeat</h4>

<p>I use this field to set things like daily, weekly, and monthly chores.  Pretty intuitive.</p>

<h4>So far I have not used most of the other fields since they do not affect my workflow.</h4>

<h3>What&#8217;s Next?</h3>

<p>For a while now I have been using RTM almost exclusively.  This has worked pretty well so far, but is not perfect.  The next step is to figure out how GMail, Remember the Milk, and Google Calendar can work together.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/datacontractserializer-serialization-error">DataContractSerializer Read-Only Property Serialization Error</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-12T17:55:36-04:00" pubdate data-updated="true">Jul 12<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently encountered an exception with a message that looked something like this:</p>

<p>There was an error deserializing the object of type Foo.  No set method for property &#8221; in type &#8221;.</p>

<p>Huh?</p>

<p>This was coming out of WriteObject (or a similar method) of DataContractSerializer (or DataContractJsonSerializer, or some other flavor).</p>

<p>If you see this error, don&#8217;t be thrown off by the bizarre error message.  If my experience holds true this error is in fact caused by a read-only property.  Unfortunately, the error message won&#8217;t give you any clues to what the property is, and the offending type is probably NOT the type Foo, as the error message suggests.</p>

<p>Description of my scenario:</p>

<ul>
<li><p>Attempt to serialize an object with a property that is a list of WCF serializable objects (base type).</p></li>
<li><p>The last item in the list is a sub type, &#8220;Foo&#8221;, that contains a property WITHOUT a setter. Serialization is ok.</p></li>
<li><p>After the item of type &#8220;Foo&#8221;, another item of type &#8220;Bar&#8221; (a different sub type) is added. This type does NOT have any properties without a setter. Attempting to serialize the parent object now fails with message &#8220;There was an error deserializing the object of type Bar, My Assembly. No set method for property &#8221; in type &#8221;.&#8221;</p></li>
</ul>


<p>See this <a href="https://connect.microsoft.com/wcf/feedback/details/525090/wcf-serialization-error-message-does-not-specify-type-and-method?wa=wsignin1.0#tabs">ticket</a> and this <a href="http://stackoverflow.com/questions/1731572/error-using-wcf-and-datacontractserializer">stackoverflow post</a> (author describes a slightly different scenario) for more information.</p>

<p>Good luck! :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/extension-methods-and-generic-type-parameters">Extension Methods and Generic Type Parameters</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-24T03:40:28-04:00" pubdate data-updated="true">Jun 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Edit 2010-06-29:  <a href="http://stackoverflow.com/questions/3118898/c-extension-method-on-type-with-generic-type-argument">question on stackoverflow</a></p>

<p>Edit 2010-07-01:  <a href="http://stackoverflow.com/questions/3118898/c-extension-method-on-type-with-generic-type-argument/3159532#3159532">question answered</a></p>

<p>This is going to be a short post, and I’ll get right to the point.</p>

<p>I’m looking at ways to improve the consistency, brevity, and readability of some code in the application I’m working on.  The starting code looked something like this:</p>

<ul>
<li><p>context.GetGraphType<Bar>().Subscribe<Fizz>(</p></li>
<li><p>(instance, evt) => e.Execute((Bar)instance.Instance)</p></li>
<li><p>);</p></li>
</ul>


<p>It breaks down like this:</p>

<ul>
<li><p>Get some type</p></li>
<li><p>Subscribe to an event</p></li>
<li><p>When the event happens, do something</p></li>
</ul>


<p>It just so happens that we have all followed an unspoken convention: an Execute method with a single parameter that is of the type that is subscribing to the event (Bar).  You can imagine that once you have over a dozen of these subscriptions it can start to look a little silly.  More on that later.</p>

<p>So, I wanted to rewrite it to look something like this:</p>

<ul>
<li>typeof(Bar).SubscribeTo<Fizz>(context);</li>
</ul>


<p>My hope was that it now reads something like “bar subscribes to the fizz event on the given context”, rather than “the context gets the bar type and subscribes to fizz and then does some stuff.”  Hopefully I’m not totally off base here.  I did check with a co-worker and he confirmed my thoughts.</p>

<p>In order to accomplish the above I wanted to make use of an abstract generic base class for the events, something like:</p>

<ul>
<li><p>public abstract class Event<T></p></li>
<li><p>{</p></li>
<li><p>public abstract void Execute(T arg);</p></li>
<li><p>}</p></li>
</ul>


<p>In the example, T is Bar - the type that subscribes to the event.  I implemented the SubscribeTo method as a local extension method.  Unfortunately, I got stuck when I tried to set up a generic type parameter that would be of type Bar.  Something like this:</p>

<ul>
<li><p>public static void SubscribeTo<TEvent>(this Type type, Context context)</p></li>
<li><p>where TEvent : Event<the value of parameter 1></p></li>
<li><p>{</p></li>
<li><p>// do stuff&#8230;</p></li>
<li><p>}</p></li>
</ul>


<p>If this were possible, one would be able to implement the change I proposed with type checking.  The compiler would verify that Fizz was a subclass of Event<Bar> and the extension method could treat it as such.</p>

<p>Do you know of a way to implement what I have proposed, or an alternative that is very similar?</p>

<p>Back to the convention I mentioned earlier.  In the spirit of utilizing conventions, I ended up using reflection to take advantage of it.  It isn’t checked by the compiler, but we have the next best thing.  The code runs on application start-up and the Execute method is retrieved when the event is subscribed to, not raised.  So, it will fail very early if there is a problem.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/arguments-callee-caller">arguments&#8230;callee&#8230;caller&#8230;</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T20:40:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Originally posted May 3 2010</em></p>

<p>Recently I spent some time looking at generating a stack trace in JavaScript for the purpose of error reporting.  There are plenty of <a href="http://eriwen.com/javascript/stacktrace-update/">existing</a> <a href="http://helephant.com/2007/05/diy-javascript-stack-trace/">projects</a> out there that solve this problem, so I wouldn&#8217;t recommend rolling your own.</p>

<p>As a result of this I came across some odd behavior in JavaScript.  The code I was working with takes advantage of the special &#8220;arguments&#8221; variable (the &#8220;array&#8221; of arguments passed to the current function), which has a special &#8220;callee&#8221; property (the function that was called), which also has a special &#8220;caller&#8221; property (the function that called this function).  You can probably see how this would be tempting if you&#8217;re trying to construct a stack trace.  Unfortunately, this information is attached to the function object rather than some sort of &#8220;function invocation&#8221; object.  There are at least two cases where this makes constructing an accurate stack trace impossible.</p>

<ol>
<li>Function recursively calls itself.</li>
</ol>


<pre><code>* Since the caller property is attached to the function itself there is no way of knowing (through this information alone) how many times the function was called.
</code></pre>

<ol>
<li>Function A calls function B, which then calls function A&#8230;</li>
</ol>


<pre><code>* Even if there are terminating condition, the code that attempts to reconstruct the stack trace (using "callee" and "caller") will not terminate.  There is a good description of this behavior [here](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/caller).
</code></pre>

<p>I was primarily interested in scenario 2, since this can cause errors.  To get around this you can detect that you have already encountered a given function and simply stop.  Of course this means that you lose any information that follows, but at least you won&#8217;t hang the browser.</p>

<p>Conclusion:  always check MDC :)</p>

<p><a href="http://eriwen.com/javascript/stacktrace-update/">http://eriwen.com/javascript/stacktrace-update/</a></p>

<p><a href="http://helephant.com/2007/05/diy-javascript-stack-trace/">http://helephant.com/2007/05/diy-javascript-stack-trace/</a></p>

<p><a href="http://bytes.com/topic/javascript/answers/470251-recursive-functions-arguments-callee-caller">http://bytes.com/topic/javascript/answers/470251-recursive-functions-arguments-callee-caller</a></p>

<p><a href="http://msdn.microsoft.com/en-us/library/7t96kt3h">http://msdn.microsoft.com/en-us/library/7t96kt3h</a></p>

<p><a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/caller">https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/caller</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/web-service-syntax-error">Web Service Syntax Error???</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T20:37:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Originally posted April 7 2010</em></p>

<p>Ok, I&#8217;ll start this post off with some background.  A couple of years ago I wrote a SOAP web service that manages printing for multiple users through a web application.  Sounds familiar, right?  Anyway, the client that interacts with the web service uses the Microsoft AJAX JavaScript framework (version 1).  The web service is hosted on a different server and domain.  However, since this is an internal application with a small number of users they were content to enable cross-domain data access and be done with it.</p>

<p>A few weeks ago one of my coworkers was revisiting the client portion, which just happened to be upgraded to the <a href="http://ajax.codeplex.com/">beta version of the AJAX JavaScript framework</a>.  He started to see a syntax error, which I determined was occurring when handling the web service response.  I knew that the client framework supported JSONP in some form, and I also noticed an interesting &#8220;jsonp&#8221; query string argument in the web service call.  Believe it or not, the client was trying to use JSONP, even though the web service response was XML!  This obviously would result in a syntax error when trying to deserialize.</p>

<p>After looking over the JavaScript code I determined that the WebServiceProxy was using JSONP if either the protocol or host of the request was different than the current page.  I now know in hindsight that the documentation (at least in code) of WebServiceProxy.invoke clearly states this.  Luckily, the &#8220;enableJsonp&#8221; parameter can be set to <em>false</em> to override this behavior.</p>

<p>So, the bottom line is:  if you&#8217;re accessing a web service across domains and you don&#8217;t want to use JSONP, you have to set the  &#8220;enableJsonp&#8221; argument to <em>false</em>.  Here&#8217;s the method signature and documentation&#8230;</p>

<p>WebServiceProxy.invoke(servicePath, methodName, useGet, params, onSuccess, onFailure, userContext, timeout, enableJsonp, jsonpCallbackParameter) {</p>

<p>/// <summary locid="M:J#Sys.Net.WebServiceProxy.invoke"></summary></p>

<p>/// <param name="servicePath" type="String">Path to the webservice</param></p>

<p>/// <param name="methodName" type="String" mayBeNull="true" optional="true">Method to invoke</param></p>

<p>/// <param name="useGet" type="Boolean" optional="true" mayBeNull="true">Controls whether requests use HttpGet</param></p>

<p>/// <param name="params" mayBeNull="true" optional="true">Method args.</param></p>

<p>/// <param name="onSuccess" type="Function" mayBeNull="true" optional="true">Success callback</param></p>

<p>/// <param name="onFailure" type="Function" mayBeNull="true" optional="true">Failure callback</param></p>

<p>/// <param name="userContext" mayBeNull="true" optional="true">Success callback</param></p>

<p>/// <param name="timeout" type="Number" optional="true" mayBeNull="true">Timeout in milliseconds</param></p>

<p>/// <param name="enableJsonp" type="Boolean" optional="true" mayBeNull="true">Whether to use JSONP if the servicePath is for a different domain (default is true).</param></p>

<p>/// <param name="jsonpCallbackParameter" type="String" optional="true" mayBeNull="true">The name of the callback parameter for JSONP request (default is callback).</param></p>

<p>/// <returns type="Sys.Net.WebRequest" mayBeNull="true">Returns the request that was sent (null for JSONP requests).</returns></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ms-ajax-and-json-date-serialization">MS AJAX and JSON Date Serialization</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T19:25:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;m making heavy use of Microsoft AJAX right now at work.  No, not the webforms controls, the <a href="http://asp.net/ajax/">JavaScript library</a>.  That&#8217; s a little better, right?</p>

<p>Anyway, one of the nice little features in MS AJAX is the ability to invoke a web service, passing in some arbitrary JavaScript object(s), and it just works!  Well, mostly of the time anyway.  Today I found out that you have to be careful with dates.  When I called a web service in this manner, and the object was a <a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date">Date</a> or contained a Date, the deserialized DateTime object on the server was off by several hours.</p>

<p>At this point you&#8217;re probably thinking, &#8220;I know what the problem is, you idiot!  It&#8217;s local time!&#8221;  Hopefully you&#8217;re more polite than that, but you would be right, of course.  Since <a href="http://www.json.org/">JSON doesn&#8217;t account for dates</a>, we&#8217;re forced to improvise.  Check out <a href="http://weblogs.asp.net/bleroy/archive/2008/01/18/dates-and-json.aspx">this link</a> for a discussion of the JSON date format that the AJAX team decided on using.  You&#8217;ll notice that he mentions several time that the string format represents a <strong>UTC</strong> date &amp; time.  In my own defense, I simply provided a Date object and the rest was supposed to be magic (as we developers are so fond of saying).  After all, the Date object does include <a href="https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date/getTimezoneOffset">time zone information</a>.  Unfortunately, the serialization code doesn&#8217;t take that into account.</p>

<p>if (Date.isInstanceOfType(object)) {
stringBuilder.append(&#8216;&#8221;\/Date(&#8216;).
append(object.getTime()).
append(&#8216;)\/&#8221;&#8217;);
break;
}</p>

<p>Since the date was going to be converted to a string anyway I went ahead and did the conversion ahead of time.  Something like this&#8230;</p>

<p>var offset = obj.getTimezoneOffset() * 100 / 60;
var offsetText = offset >= 1000 ? offset.toPrecision(4) : &#8220;0&#8221; +
offset.toPrecision(3);
return &#8220;/Date(&#8221; + (+obj).toString() + &#8220;-&#8221; + offsetText + &#8220;)/&#8221;;</p>

<p>There are, of course, other ways to do this.  You could convert the date to a UTC date and let the serialization code do its thing.  This was my first solution, but I scrapped it in favor of the code above since it&#8217;s more consistent with how the dates were formatted when sent from the server.  You could also parse out the offset from the date string with a regex, but that just didn&#8217;t feel right.</p>

<p>Moral of the story:  either make sure your dates are UTC or serialize with the offset yourself.  I could think of cases where both would be inconvenient or impractical.  Hopefully you don&#8217;t have to face that problem.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tiny-mce-spellchecker-gotcha">Tiny MCE Spellchecker Gotcha</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T19:13:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In hindsight this should have been a lot easier&#8230;</p>

<p>If you&#8217;re not familiar with <a href="http://tinymce.moxiecode.com/">tinymce</a> you should go <a href="http://tinymce.moxiecode.com/examples/full.php">check it out</a>.  Its a solid rich text editor for the web, which can be easily initialized and manipulated via JavaScript.  And best of all, <a href="http://tinymce.moxiecode.com/download.php">its free</a>!</p>

<p>Today I ran into a problem with the spell checking feature.  I&#8217;ll go ahead and state up front:  this was <strong>NOT</strong> a problem with tinymce.  This was my own doing.  It seemed that, although the spell checker was able to report misspellings in the editor, when you clicked on a misspelled word the highlighting would disappear and no context menu was shown.  Strange&#8230;</p>

<p>First off, tinymce&#8217;s source code can be downloaded from <a href="http://tinymce.moxiecode.com/download.php">their site</a> (see &#8220;Deveopment package&#8221;), which made debugging <strong><em>really</em></strong> easy.  I noticed while inspecting the page using <a href="http://getfirebug.com/">firebug</a> that when I triggered spell checking the misspelled word(s) in the editor were wrapped in a span with a special class name.  I tracked down the spot in the code where the text was wrapped happened, and more importantly unwrapped, and then set breakpoints so that I could intercept when this was happening.  I found that it was ultimately being called from a &#8220;mousedown&#8221; event, which was in turn creating a new undo operation in the editor and firing the editor&#8217;s custom &#8220;change&#8221; event.</p>

<p>This took me back a few month to when I was integrating the editor into the website.  We basically use the editor to replace text areas on the page, which I gather is the norm.  Believe it or not, tinymce is kind enough to keep the original text area up to date as you make changes.  Unfortunately it doesn&#8217;t seem to fire the native browser events that we needed to detect that these changes were occurring.  The editor has its own <a href="http://wiki.moxiecode.com/index.php/Editor">events</a>, some which mimic native browser events.</p>

<p>One in particular that I was interested in was the &#8221;<a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/onChange">onChange</a>&#8221; event.  The documentation states that the event is raised &#8221;<em>when contents inside the editor gets changed</em>.&#8221;  If you look at the event handler arguments (Parameters) you&#8217;ll see that it makes mention of &#8220;undo levels&#8221; and &#8220;undo managers&#8221;.  As I understand it, the event actually fires when an &#8220;undo level&#8221; is added, some atomic action that can be reverted.  This explains why changes were being picked up at seemingly arbitrary times while editing the text.</p>

<p>Anyway, what does any of this have to do with the spell checking results disappearing?  Well, it turns out there were a couple of factors at work here.  The first I have already hinted at.  We were watching for &#8220;change&#8221; events on the editor and reacting accordingly.  These change events were also firing when you click inside of the editor, which is something that you would obviously do if you were trying to fix a typo to get rid of that nasty red underlining.  I presume this is because when the user has clicked, the text that they have typed can be viewed as an atomic action.  This can be slightly confusing if you don&#8217;t know what to expect, but it does make some sense in that it follows Microsoft Word behavior (a worthy goal for a rich text editor).</p>

<p>At any rate, the second factor was even more tricky.  The behavior that depends on knowing when the editor changes  (the reason we&#8217;re subscribing to the onChange event in the first place) also has to know what the current value is.  It is essentially a property change eventing mechanism.  This is all well and good, except that I was getting the editor&#8217;s value through the editor object&#8217;s <a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/getContent">getContent</a> method, without so much as skimming the documentation for it (it seemed pretty straightforward).  The documentation states that the function will &#8221;<em>cleanup the content before it gets returned using the different cleanup rules options</em>.&#8221;</p>

<p>If you think about it for a minute, you can see why this is a problem.  The editor&#8217;s content is essentially going to be the html that is displayed, right?  So, if the function is going to return the editor&#8217;s content, then it seems reasonable for it to &#8221;<em>cleanup the content</em>&#8221; first.  And what would cleaning up the content involve?  That&#8217;s right!  It removes the html that wraps the text to signify that a word is misspelled.  After all, we wouldn&#8217;t want to store that in the database.</p>

<p>So at this point I&#8217;ve determined what the problem is.  Luckily, it doesn&#8217;t appear that I need to call the getContent method after all.  The original text area&#8217;s value is updated anyway, so I just read the value directly from the text area.  Problem solved!  Now I can go home&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/add-javascript-to-a-pdf-document-with-itextsharp">Add JavaScript to a PDF Document With iTextSharp</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T18:58:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Originally posted June 8 2010</em></p>

<p>As you might have guessed from the title, this post is of the “get it done” variety.  So, the code may be a little rough.  Its the sort of code that works, but isn’t fully understood (by me at least).  I wasn’t able to find a clear example on the net, so I pieced together examples and guesses based on reading the code and interpreting method and class names.</p>

<p>Why guess?  Well, <a href="http://sourceforge.net/projects/itextsharp/">iTextSharp</a> is a pretty robust open source project which is useful for creating and manipulating PDF documents.  The problem is, it doesn’t seem to have any useful documentation online.  It <strong><em>is</em></strong> open source, so you can read the code all day.  Also, there are some tutorials that you can download from the <a href="http://sourceforge.net/projects/itextsharp/files/">files page</a> (in the examples folder).</p>

<p>The goal was to have a PDF document print automatically from a web page.  I decided to pass on coming up with a cross-browser (read: works in IE) method for automatically printing the document on the client, and instead decided to insert JavaScript into the generated PDF document that would cause it to print when opened.  This is what I came up with.</p>

<p>PdfReader reader = new PdfReader(inputStreamOrFile);</p>

<p>int pageCount = reader.NumberOfPages;</p>

<p>Rectangle pageSize = reader.GetPageSize(1);</p>

<p>// Setup writer</p>

<p>PdfDocument document = new PdfDocument(pageSize);</p>

<p>PdfWriter writer = PdfWriter.GetInstance(document, outputStreamOrFile);</p>

<p>document.Open();</p>

<p>// Copy each page</p>

<p>PdfContentByte content = writer.DirectContent;</p>

<p>for (int i = 0; i &lt; pageCount; i++)</p>

<p>{</p>

<p>document.NewPage();</p>

<p>PdfImportedPage page = writer.GetImportedPage(reader, i + 1); // page numbers are one-based</p>

<p>content.AddTemplate(page, 0, 0); // x and y correspond to position on the page?</p>

<p>}</p>

<p>// Insert JavaScript to print the document after a fraction of a second (allow time to become visible).</p>

<p>string jsText = &#8220;var res = app.setTimeOut(&#8216;var pp = this.getPrintParams();pp.interactive = pp.constants.interactionLevel.full;this.print(pp);&#8217;, 200);&#8221;;</p>

<p>//string jsTextNoWait = &#8221;var pp = this.getPrintParams();pp.interactive = pp.constants.interactionLevel.full;this.print(pp);&#8221;;</p>

<p>PdfAction js = PdfAction.JavaScript(jsText, writer);</p>

<p>writer.AddJavaScript(js);</p>

<p>document.Close()</p>

<p>As for the JavaScript, the call to setTimeOut is there so that the PDF is rendered before the print dialog is shown.  Otherwise, the users will see the print dialog and a blank page, which may be confusing.  If the PDF is not visible anyway (as in my case) then you don’t really need the timeout.  The actual printing is based on the documentation of Acrobat JavaScript from <a href="http://livedocs.adobe.com/acrobat_sdk/9.1/Acrobat9_1_HTMLHelp/wwhelp/wwhimpl/js/html/wwhelp.htm?href=JS_API_AcroJSPreface.87.6.html&amp;accessible=true">Adobe’s website</a>.  In this example, the <a href="http://livedocs.adobe.com/acrobat_sdk/9.1/Acrobat9_1_HTMLHelp/wwhelp/wwhimpl/js/html/wwhelp.htm?href=JS_API_AcroJSPreface.87.6.html&amp;accessible=true">iteration level</a> is set to “full”, meaning that the user will get the print dialog and progress feedback.  You can also use “automatic” (no dialog, includes progress) and “silent” (no dialog or progress).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pdf-embed-weirdness">PDF Embed Weirdness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T18:55:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Originally posted April 5 2010</em></p>

<p>The other day I was working on a web page where the user does some stuff and then as the result a nice, shiny PDF is embedded in the page.  I noticed that in Internet Explorer (I was using IE8) the embedded region showed up as a blank rectangle with a little icon in the upper left-hand corner.  Weird…</p>

<p>One of my co-workers suggested that I try embedding a static PDF file.  In my case the source URL was an aspx page that dynamically renders the PDF.  But that can’t possibly matter, right?  I mean, as long as the content type is correct and the file is intact.  I guess it does.</p>

<p>I won’t bore you with the details, but I determined through trial and error that the following conditions had to be met for the embedded PDF to display in IE8:</p>

<p>1)  The “type” attribute must be specified as “application/pdf”, regardless of the fact that the external resource has the correct content type header.  Because of my own ignorance I freely accept that there is probably a good reason for this.  Besides, its good practice anyway – especially in my case (“what does this Page.aspx render as???”).</p>

<p>2)  The URL must include “pdf” or “.pdf” (not sure if the “.” is necessary), even if on the query string!  Really?  I didn’t believe it myself, but I tested a gratuitous number of times and eventually disbelief gave way to sheer exhaustion.</p>

<p>3)  Embed tag must be injected into the page with all attribute values at once (using jQuery) rather than injecting the tag and then setting attribute values (like type and src).  This may be a jQuery issue, but its worth mentioning anyway.</p>

<p>So, the moral of the story is…</p>

<p>If it doesn’t work then first reduce the problem to its simplest form.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/4/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/2/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/file-dot-openwrite-gotcha">File.OpenWrite Gotcha</a>
      </li>
    
      <li class="post">
        <a href="/blog/chrome-select-excessive-padding">Chrome select excessive padding</a>
      </li>
    
      <li class="post">
        <a href="/blog/should-you-write-awesome-code">Should you write awesome code?</a>
      </li>
    
      <li class="post">
        <a href="/blog/carolina-code-camp-2012-presentation">Carolina Code Camp 2012 Presentation</a>
      </li>
    
      <li class="post">
        <a href="/blog/learning-f-with-tdd-part-2">Learning F# with TDD: Part 2</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mattheyan">@mattheyan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mattheyan',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("BryanMatthews", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/BryanMatthews" class="twitter-follow-button" data-show-count="false">Follow @BryanMatthews</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/mattheyan?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bryan Matthews -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
