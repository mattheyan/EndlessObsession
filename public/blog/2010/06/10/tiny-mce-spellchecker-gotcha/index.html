
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tiny MCE Spellchecker Gotcha - The Endless Obsession</title>
  <meta name="author" content="Bryan Matthews">

  
  <meta name="description" content="In hindsight this should have been a lot easier&#8230; If you&#8217;re not familiar with tinymce you should go check it out.  Its a solid rich text &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://endlessobsession.heroku.com/blog/2010/06/10/tiny-mce-spellchecker-gotcha">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="The Endless Obsession" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The Endless Obsession</a></h1>
  
    <h2>better code</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:endlessobsession.heroku.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Tiny MCE Spellchecker Gotcha</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-06-10T19:13:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In hindsight this should have been a lot easier&#8230;</p>

<p>If you&#8217;re not familiar with <a href="http://tinymce.moxiecode.com/">tinymce</a> you should go <a href="http://tinymce.moxiecode.com/examples/full.php">check it out</a>.  Its a solid rich text editor for the web, which can be easily initialized and manipulated via JavaScript.  And best of all, <a href="http://tinymce.moxiecode.com/download.php">its free</a>!</p>

<p>Today I ran into a problem with the spell checking feature.  I&#8217;ll go ahead and state up front:  this was <strong>NOT</strong> a problem with tinymce.  This was my own doing.  It seemed that, although the spell checker was able to report misspellings in the editor, when you clicked on a misspelled word the highlighting would disappear and no context menu was shown.  Strange&#8230;</p>

<p>First off, tinymce&#8217;s source code can be downloaded from <a href="http://tinymce.moxiecode.com/download.php">their site</a> (see &#8220;Deveopment package&#8221;), which made debugging <strong><em>really</em></strong> easy.  I noticed while inspecting the page using <a href="http://getfirebug.com/">firebug</a> that when I triggered spell checking the misspelled word(s) in the editor were wrapped in a span with a special class name.  I tracked down the spot in the code where the text was wrapped happened, and more importantly unwrapped, and then set breakpoints so that I could intercept when this was happening.  I found that it was ultimately being called from a &#8220;mousedown&#8221; event, which was in turn creating a new undo operation in the editor and firing the editor&#8217;s custom &#8220;change&#8221; event.</p>

<p>This took me back a few month to when I was integrating the editor into the website.  We basically use the editor to replace text areas on the page, which I gather is the norm.  Believe it or not, tinymce is kind enough to keep the original text area up to date as you make changes.  Unfortunately it doesn&#8217;t seem to fire the native browser events that we needed to detect that these changes were occurring.  The editor has its own <a href="http://wiki.moxiecode.com/index.php/Editor">events</a>, some which mimic native browser events.</p>

<p>One in particular that I was interested in was the &#8221;<a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/onChange">onChange</a>&#8221; event.  The documentation states that the event is raised &#8221;<em>when contents inside the editor gets changed</em>.&#8221;  If you look at the event handler arguments (Parameters) you&#8217;ll see that it makes mention of &#8220;undo levels&#8221; and &#8220;undo managers&#8221;.  As I understand it, the event actually fires when an &#8220;undo level&#8221; is added, some atomic action that can be reverted.  This explains why changes were being picked up at seemingly arbitrary times while editing the text.</p>

<p>Anyway, what does any of this have to do with the spell checking results disappearing?  Well, it turns out there were a couple of factors at work here.  The first I have already hinted at.  We were watching for &#8220;change&#8221; events on the editor and reacting accordingly.  These change events were also firing when you click inside of the editor, which is something that you would obviously do if you were trying to fix a typo to get rid of that nasty red underlining.  I presume this is because when the user has clicked, the text that they have typed can be viewed as an atomic action.  This can be slightly confusing if you don&#8217;t know what to expect, but it does make some sense in that it follows Microsoft Word behavior (a worthy goal for a rich text editor).</p>

<p>At any rate, the second factor was even more tricky.  The behavior that depends on knowing when the editor changes  (the reason we&#8217;re subscribing to the onChange event in the first place) also has to know what the current value is.  It is essentially a property change eventing mechanism.  This is all well and good, except that I was getting the editor&#8217;s value through the editor object&#8217;s <a href="http://wiki.moxiecode.com/index.php/TinyMCE:API/tinymce.Editor/getContent">getContent</a> method, without so much as skimming the documentation for it (it seemed pretty straightforward).  The documentation states that the function will &#8221;<em>cleanup the content before it gets returned using the different cleanup rules options</em>.&#8221;</p>

<p>If you think about it for a minute, you can see why this is a problem.  The editor&#8217;s content is essentially going to be the html that is displayed, right?  So, if the function is going to return the editor&#8217;s content, then it seems reasonable for it to &#8221;<em>cleanup the content</em>&#8221; first.  And what would cleaning up the content involve?  That&#8217;s right!  It removes the html that wraps the text to signify that a word is misspelled.  After all, we wouldn&#8217;t want to store that in the database.</p>

<p>So at this point I&#8217;ve determined what the problem is.  Luckily, it doesn&#8217;t appear that I need to call the getContent method after all.  The original text area&#8217;s value is updated anyway, so I just read the value directly from the text area.  Problem solved!  Now I can go home&#8230;</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bryan Matthews</span></span>

      








  


<time datetime="2010-06-10T19:13:00-04:00" pubdate data-updated="true">Jun 10<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/javascript/'>javascript</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://endlessobsession.heroku.com/blog/2010/06/10/tiny-mce-spellchecker-gotcha/" data-via="BryanMatthews" data-counturl="http://endlessobsession.heroku.com/blog/2010/06/10/tiny-mce-spellchecker-gotcha/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/06/10/add-javascript-to-a-pdf-document-with-itextsharp/" title="Previous Post: Add JavaScript to a PDF Document with iTextSharp">&laquo; Add JavaScript to a PDF Document with iTextSharp</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/06/10/ms-ajax-and-json-date-serialization/" title="Next Post: MS AJAX and JSON Date Serialization">MS AJAX and JSON Date Serialization &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/11/learning-f-with-tdd-part-2/">Learning F# with TDD: Part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/02/exoweb-type-loading-changes/">ExoWeb type loading changes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/08/21/learning-fsharp-with-tdd-part-1/">Learning F# with TDD: Part 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/07/11/disable-the-audible-beep-in-mac-terminal/">Disable the audible beep in Mac Terminal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/07/08/tfs-rollback-2/">Tfs Rollback</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mattheyan">@mattheyan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mattheyan',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("BryanMatthews", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/BryanMatthews" class="twitter-follow-button" data-show-count="false">Follow @BryanMatthews</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/mattheyan?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Bryan Matthews -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
